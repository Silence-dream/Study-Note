---
tags : 
- 
---
## 什么是Web3?

在 Web3 之前的互联网时代，用户能够进行各种在线活动，他们可以浏览网页，可以生成自己的文字、图片、视频等内容，并在社交网络上分享和交流，创造出丰富多彩的网络生活。比如，在微博上社交、在公众号上发表文章，在淘宝上购物、在抖音上传短视频作品等等。
然而，这个时代也带来了一些问题。尽管用户可以自由地创造和分享内容，但这些内容及相关的数据实际上被运营这些平台的科技公司所控制。用户虽然是内容的生产者，但对于自己的数据并没有真正的所有权。这导致了一系列的隐私和安全问题，用户的个人信息有可能被不当使用或泄露。
正是在这样的背景下，Web3（又叫做 Web3.0 ）的概念应运而生。简单来说，Web3 是建立在区块链技术之上的下一代互联网。它强调去中心化，即没有中心化的控制机构来管理数据和资源。

## Web3的意义

在 Web3 的世界里，用户对自己创造的内容和数据拥有真正的所有权，从而摆脱对传统中心化平台的依赖。此外，Web3 通过智能合约和区块链技术实现的不可篡改和透明性特征，可以促进信任的建立，降低欺诈和中介成本。Web3 还激发了新的商业模式和经济系统，如去中心化金融（ [[DeFi]] ）、非同质化代币（ [[NFT]] ）和去中心化自治组织（ [[DAO]] ）等等。

总之，Web3 不仅仅是技术的革新，更是一场关于数据自主权的社会运动，代表着人们对隐私保护的更高追求。


## Web3 领域分析

### 赛道整体介绍

Web3 致力于构建一个去中心化、由用户主导的下一代互联网。在这个生机勃勃的领域中，广泛分布着各种类型的赛道，涵盖了去中心化金融（ [[DeFi]] ）、非同质化代币（ [[NFT]] ）、去中心化自治组织（ [[DAO]] ）、去中心化身份（ [[DID]] ）、社交金融（ [[SocialFi]] ）、游戏金融（ [[GameFi]] ）和基础设施等关键领域。每个赛道都孕育出了具有创新性和影响力的经典项目，从为用户提供金融自主权 的 DeFi 协议，到赋予数字创作独特身份的 NFT 市场，再到通过 DAO 促进群体决策的平台。每个赛道都是 Web3 世界的一个关键支点，共同构建起一个更加开放、透明和包容的数字未来。

#### 去中心化金融 DeFi

去中心化金融（ Decentralized Finance，简称DeFi ）是基于区块链、智能合约技术的金融服务和应用，允许用户直接通过智能合约进行金融交易。与传统的中心化金融（ CeFi ）不同，DeFi 不依赖中央权威或中介机构来提供金融服务。在 DeFi 生态中，传统金融中的银行、经纪人和其他中介机构被智能合约所代替，一切都是通过代码来自动运行的，并且是开放透明的，任何人都可以参与验证。

去中心化金融为用户提供全球范围内无缝接入的金融服务，包括很多创新性的金融产品和服务，典型的 Defi 项目有 Uniswap（去中心化交易平台）、Aave（去中心化借贷平台）、MakerDAO（去中心化稳定币 DAI ）等，这些项目推动金融行业向更加开放、透明和包容的方向发展。同时，DeFi 还通过分布式账本技术保障了金融交易记录的不可篡改性，从而增强了金融系统的安全性。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071446950.png)


#### 非同质化代币 NFT

非同质化代币（ Non-Fungible Token，简称NFT ）是一种特殊类型的加密资产，它建立在区块链技术之上，通过智能合约保证其唯一性和稀缺性。与传统的加密货币（如比特币或以太坊）不同，每个 NFT 都有独特的身份标识。每个 NFT 就像一件有独特编号的艺术品或收藏品，比如一幅画或一枚限量版邮票，因为它们各自有不同的价值和特征，所以你不能简单地把它们进行交换。

非同质化代币具备唯一性和所有权的不可篡改性，这为数字内容创造者提供了将作品货币化的方式。典型的 NFT 项目有数字艺术平台 OpenSea 和 Rarible，这些平台让创作者能够直接向收藏爱好者销售其作品。此外，NFT 还可以用于游戏中，例如加密猫（ CryptoKitties ）这个游戏，每只猫咪都是一个独特的 NFT，玩家可以在游戏里购买、繁育和交易猫咪。随着 NFT 技术的成熟和市场的认可， NFT 正在逐渐扩展到更多的领域，如音乐、影视和体育等。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071447035.png)


#### 去中心化组织 DAO

去中心化自治组织（ Decentralized Autonomous Organization，简称DAO ）是一种基于区块链技术的创新组织形式，它不同于传统的中心化管理结构。在 DAO 中，权力和决策过程是分散的，对于重大的问题，比如资金分配、规则制定和项目发展方向等，不是由单个领导或小团体决定，而是由持有组织代币的成员共同投票决策。DAO 通过把规则写入代码中，由智能合约来自动执行，确保了规则的确定和透明。

去中心化自治组织允许成员在没有中央管理者的情况下共同做出决策，这样的组织形式能够促进更加公平和透明的决策过程，同时也增强了社区成员之间的协作。典型的 DAO 项目有 MolochDAO，它是一个专注于为以太坊生态系统提供资金支持的组织，其运作方式是成员提交提案请求资金，然后其他成员共同投票决定是否批准这些提案，如果有足够多的投票支持，那就会从 DAO 的资金库中拨款来执行这些提案。MolochDAO 的提案信息是公开的，任何人都可以查看项目的介绍、投票和执行情况，从而增加了透明度和社区参与度。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071448079.png)


#### 社交金融 SocialFi

社交金融（ Social Finance，简称 SocialFi ），结合社交网络和去中心化金融（ DeFi ）的特点，通过区块链技术，实现了社交互动的同时进行资产的生成、交换和增值。与传统社交平台不同的是， SocialFi 平台让用户在参与社交活动如发帖、评论、分享内容时得到实质性的经济奖励，比如代币或 NFT，同时保证了他们对自己数据的所有权和控制权。这种模式打破了传统社交网络的利益分配机制，将价值回馈给内容创造者和社区成员。

社交金融重新定义了内容创造和社区参与的奖励系统，用户不仅能享受社交乐趣，还能从中获得实际收益。Mirror 是当前较为主流的 SocialFi 项目之一，Mirror 平台利用区块链技术确保创作者拥有其作品的数字版权，并且能够通过加密货币进行收益分配。比如创作者在平台上发布文章后，可以根据文章的受欢迎程度和用户的互动情况（点赞、分享、评论等），获得相应的代币奖励。创作者还可以在平台上进行众筹活动，使用智能合约创建代币化的众筹项目，这些代币可能会随着创作者的成功而增值，从而吸引投资者支持他们的创作。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071449127.png)


#### 游戏金融 GameFi

游戏金融（ Game Finance，简称 GameFi ）是一种结合了加密货币和非同质化代币（ NFT ）的游戏模式，玩家可以在虚拟的游戏世界中参与活动，并通过这些活动获得实际的经济回报。这种游戏模式赋予玩家拥有资产的所有权和交易能力，允许他们自由地买卖、交换或投资这些资产。GameFi 项目往往集成了 DeFi（去中心化金融）的功能，如流动性挖矿、借贷和收益农场，使玩家在享受游戏乐趣的同时，还能参与到复杂的金融活动中。

游戏金融创造了一个全新的经济模型，玩家的时间和技能可以转化为现实世界的财富，同时也促进了数字资产的流通和创新。Axie Infinity 作为典型的 GameFi 项目，让用户通过购买、培育、繁衍及交易虚拟宠物来参与游戏。这些宠物如果拥有稀缺的属性，往往具有更高的市场价值，用户可通过繁殖和销售这些宠物来赚取利润。此外，用户参加战斗也能够赚取 SLP 和 AXS 代币，这些代币可以在加密货币市场兑换成真实的货币。同时，将 AXS 和 SLP 代币质押到 DeFi 协议中，用户还有机会获得额外的收益。


#### 去中心化身份 DID

去中心化身份（ Decentralized Identity，简称 DID ），是一种基于区块链技术的身份认证方式，使得用户无需依赖于任何中心化组织或服务提供商，就能够拥有并控制自己的身份信息。在这个系统中，用户的身份数据被加密并分散存储在区块链网络上，用户可以自主管理其身份证明和相关数据，使用私钥进行安全验证，以此确保身份信息的可靠性和隐私性。

去中心化身份为用户提供了身份数据主权和隐私保护，一个典型的 DID 项目例子是 ENS（ Ethereum Name Service ），它允许用户将复杂的以太坊钱包地址转换为易读易记的域名，如“ alice.eth ”，从而简化了转账过程，并且提升了用户体验。此外，这些域名也是用户在 Web3 世界的身份标志，通过 ENS，用户可以更方便地管理和展示自己的去中心化身份。


## 分布式账本和去中心化

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071749377.png)

传统的银行和金融机构使用中心化的账本系统，所有的交易信息都存储在银行的内部数据库中。这种模式让银行成为数据和资金流的控制中心，虽然便于管理，但是也存在着一些弊端。比如个人信息可能存在泄露的风险，一旦银行的系统遭受黑客攻击或内部人员滥用权限，用户的财务数据和个人隐私可能会被非法获取，甚至被用于欺诈和盗窃。


### 分布式账本的诞生

2008年，随着比特币白皮书的发布，一个被称作区块链的去中心化技术首次进入大家的视野。

### 分布式账本比喻

让我们先用一个形象的比喻，来理解分布式账本和去中心化。

想象一下，你所在的班级有一笔公共经费，这笔经费只能用于班级公共开支，比如购买文具、组织活动、聚餐等。如果这笔经费的所有使用情况，都由班长一个人负责记录在他的笔记本里（这就是中心化），那么一旦班长不小心丢失了笔记本或者班长不诚实地篡改了数据，就会导致班级的经费记录出现问题，整个班级的利益都会受到损害。这就是单一账本和中心化方式存在的问题。

现在让我们换一种方式来管理这笔经费，每个同学都有自己的一个小本子（这就是去中心化），每当有经费收入或支出时，所有人都会在自己的本子上记录下来。这样，即便有少部分同学的记录出现差错，班级经费的管理仍然能够维持其透明度与可信度，因为每个人都持有一份相同的记录，这种分散记录的账本就叫分布式账本。使用分布式账本，如果某位同学需要篡改经费开支记录，必须联合一半以上的同学同时修改，这样的修改难度会随班级人数的增加而增加，篡改成功的难度非常大。


### 分布式账本典型案例

比特币，作为第一个成功的加密货币，也是分布式账本的典型应用。比特币网络由超过10000个活跃的全节点组成，这些节点遍布全球各地，任何人都可以运行一个节点，参与到网络的维护中来。节点的多样性与地理分布性，确保了网络的健壮性和抗审查能力。


## 区块链数据结构

区块链作为 Web3 生态的核心基础设施，相当于一个分布式数据库，用于存储全球范围内的交易数据、智能合约、用户身份信息和各种类型的去中心化应用（ dApps ）数据。

以太坊区块链从上往下可以依次分解为：区块链、区块、交易三个层次，其中的交易数据、收据数据、状态数据和账户数据都分别存储在四棵哈希树中。如果你是第一次接触这些概念，不用担心。在这个章节，我们将以以太坊为例，为你逐层解析区块链的数据结构。


### 区块链

区块链是一系列数据块（即“区块”），通过特定的方式相互连接，形成的一条链。每个区块都包含前一个区块的哈希值，称为“父哈希值”（ Parent Hash ），这是前一个区块内容的唯一标识符。通过这种方式，每个区块都与前一个区块相连接，形成了一条从第一个区块（创世区块）到最新区块的连续链条，这就是“区块链”。注：第一个区块里无父哈希值。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071755862.png)

### 区块

区块链中的每一个区块，都由两个部分组成：区块头（ Header ）和区块体（ Body ）。

①区块头

区块头里包含了一个区块的基本信息，主要包括：

●父哈希值（ parentHash ）：记录前一个区块的哈希值。

●时间戳（ timestamp ）：记录区块创建的具体时间。

●随机数（ nonce ）：用于工作量证明（ PoW ）机制中的挖矿过程。

●难度目标（ difficulty ）：表示挖矿的难度。

●币基（ coinBase ）：标识矿工的账户地址。

另外，区块头里还记录了三个非常重要的根哈希值：

●状态树根（ stateRoot ）：表示了区块链的状态树的根哈希值，状态树记录了所有账户的状态信息，如余额、合约代码等。

●收据树根（ receiptRoot ）：表示收据树的根哈希值，收据树记录了交易执行的结果，如交易是否成功、交易费用等。

●交易树根（ transactionRoot ）：表示交易树的根哈希值，交易树包含了区块中所有交易的信息。

②区块体

区块体里存储了该区块中的所有交易数据，即所有交易哈希的列表。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071804662.png)


### 交易

在以太坊中，交易代表从一个账户向另一个账户发送资产或消息的行为。当用户发起一笔交易时，以太坊客户端或钱包软件将会构造交易数据。交易数据主要包含如下字段：

●nonce：发送方账户的交易计数器，统计该账户在此区块链中的总交易次数。

●gasPrice：发送方愿意为每单位 gas 支付的价格。

●gasLimit：发送方为这次交易设置的最大 gas 消耗量。

●to：接收方的账户地址。

●value：要传输的以太币数量。

●data：智能合约相关的字节码。

●v, r, s：交易签名，由发送方的私钥生成。

交易数据构造完成后，钱包将使用用户的私钥对整个交易进行签名，并将签名结果（ v, r, s ）加入交易数据中，然后对整个交易数据（不包括签名）计算哈希值，交易哈希是交易数据的唯一标识符，确保了交易的唯一性和不可篡改。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071807068.png)

例如，Alice 想要发送 1 ETH 给 Bob，Alice 的账户地址是 0x123…ABC，Bob 的账户地址是 0x456…DEF。Alice 的账户已经执行过5笔交易，所以她的下一笔交易的 nonce 为6。当前的 gas 价格是 20 Gwei，她设置的 gas limit 是21000（标准以太坊转账所需的gas费）。Alice 不调用任何合约，所以 data 字段为空。
  
●nonce: 6

●gasPrice: 20000000000 (20 Gwei)

●gasLimit: 21000

●to: 0x456…DEF (Bob的地址)

●value: 1000000000000000000 (1 ETH)

●data: 0x

●v, r, s: [签名数据]

Alice 的钱包会把这些交易数据进行打包和签名，然后生成交易哈希，并将这个交易广播到以太坊网络。矿工将确认这笔交易并将其加入新区块，一旦成功，1 ETH 就会从 Alice 的账户转移到 Bob 的账户。

### 交易收据

在以太坊中，当一笔交易完成后，会生成“交易收据”（ Transaction Receipt，又叫交易回执）。交易收据记录了交易执行的基本信息，是交易被包含在区块链中的重要证据。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071818103.png)

每个交易收据包含的信息有：

●transactionHash：交易哈希值，用于唯一标识一笔交易。

●transactionIndex：交易在所在区块中的索引位置。

●blockHash：包含该交易的区块哈希值。

●blockNumber：包含该交易的区块编号。

●from：发起交易的地址。

●to：交易的目标地址。

●cumulativeGasUsed：当前区块中累积消耗的 Gas 量。

●gasUsed：这笔交易所消耗的 Gas 量。

●contractAddress：如果交易用于创建合约，则表示合约地址；否则为 null。

●logs：交易过程中产生的事件日志。

●logsBloom：布隆过滤器，用于快速检索交易日志。

●status：交易执行的状态码，表示成功或失败。

### 默克尔-帕特里夏树 Merkle Patricia Tree

以太坊每天的交易量达到数百万笔，如此多的交易数据是如何存储的呢？这里采用了一种名为Merkle Patricia Tree（ MPT ）的数据结构，这是一种特殊类型的默克尔树（ Merkle Tree ）。我们先了解一下基本的默克尔树。

①默克尔树，也称为哈希树（ Hash Tree ），这棵树的叶子节点是数据块的哈希值，非叶子节点是其子节点的哈希值串联后再次进行哈希计算的结果，这样可以确保数据的完整性。如图所示，节点值的计算方法为：

哈希 A=Hash (数据 A );

哈希 B=Hash (数据 B );

哈希 E=Hash (哈希 A+哈希 B );

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071822593.png)

②帕特里夏树（ Patricia Trie ），也称为压缩前缀树，这棵树既可以利用字符串的公共前缀来减少查询时间，又可以通过压缩无分支的节点来节省空间。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071828122.png)

③默克尔-帕特里夏树 （ Merkle Patricia Tree ） 结合了默克尔树（ Merkle Tree ）和帕特里夏树（ Patricia Trie ）的优点，既可以验证数据的完整性，也可以快速检索状态信息，非常适合用作以太坊中的数据存储。在每个区块里，分别有一棵默克尔-帕特里夏树来存储交易数据、收据数据、状态数据和账户数据。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071829194.png)


## 哈希函数和区块链链接

### 哈希函数的历史

哈希函数的概念可以追溯到20世纪50年代，当时它主要用于数据结构中，如哈希表，用来快速定位和检索数据。后来哈希函数经历了一系列的发展，旧的标准不断被更安全的新标准所替代：

MD4—>MD5—>SHA0—>SHA1—>SHA2—>SHA3

目前最先进的标准是 SHA-3，SHA-3 基于 Keccak 算法，由比利时密码学家设计，并在2015年成为 NIST 的标准。


### 什么是哈希函数

哈希函数，也称为散列函数。它将任意长度的输入（通常称为“消息”），通过数学算法转换成固定长度的字符串，这个输出通常称为哈希值、散列值、消息摘要或者数字指纹。下图以 SHA3-256 哈希函数来展示，无论输入什么，输出都是一个长度为64的十六进制字符串。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071842890.png)


### 哈希算法特征

●正向快速：无论输入的长度有多大，都能够快速计算出`64`位哈希值。比如把一个字符或者一本书的所有文字作为输入，都可以快速计算出哈希值。

●逆向困难：通过哈希值，无法在有限时间内逆向推出输入。比如通过哈希值0x8a5e1d339fafc39350fd8cf1d7ca7982091c27f6b77f75bd4ddab3df425b4f8c，无法逆向推出输入是123.

●输入敏感：输入的微小变化，会导致输出的显著变化。比如123和124的哈希值千差万别，看上去没有任何关联。

●避免碰撞：很难找到两个不同的输入，使得输出的哈希值一致（即发生碰撞）。比如很难找到除123之外的另一个输入，使它的哈希值也是0x8a5e1d339fafc39350fd8cf1d7ca7982091c27f6b77f75bd4ddab3df425b4f8c。

●不可预测：通过输入无法预测输出，所以挖矿时随机数nonce只能从1开始累加。


### 区块链中的应用

  
●确保交易数据的完整性和不可篡改性。每笔交易的哈希值都是独一无二的，任何细微的数据变化都会导致哈希值的巨大变化，使得网络参与者能够迅速发现交易数据被篡改的行为。

●将各个区块串联起来形成区块链，每个区块包含前一个区块的哈希值，从而确保了链上数据的连贯性和不可逆性。

●用于构建 Merkle 树以高效验证数据。

●实施工作量证明机制来增强区块链的安全性，通过解决计算难题来限制新区块的生成速度。



## 非对称加密公私钥体系

### 对称加密

介绍非对称加密之前，我们先来了解一下对称加密。

在对称加密中，加密和解密使用相同的密钥。意味着发送方和接收方必须事先共享这个密钥，并且都必须保守这个密钥的秘密

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071849204.png)

简单理解就是小明和小红使用同一把钥匙解锁,这个过程就是对称加密。

对称加密存在一个问题，如果钥匙在传递过程丢失（密钥泄露），可能导致保密信件中的内容被别人看到。为了解决这个问题，非对称加密应运而生。


### 非对称加密

非对称加密解决了密钥分发问题，使用一对不同的密钥：公钥和私钥，来进行数据的加密和解密。公钥和私钥需要配对使用，公钥可以公开发放，任何人都可以用它来加密信息，但只有持有私钥的人才能解密这些信息。因此，即使公钥是公开的，没有私钥的人也无法读取加密信息的内容。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071852114.png)

我们还是以小明给小红发送保密信件来举例，此时他们使用非对称加密技术来传递信件。

●第一步：小红生成了一对密钥：一个公钥和一个私钥。小红将她的公钥发送给小明，而私钥由自己来保管，不会发给任何人。

●第二步：小明得到小红的公钥后，使用公钥对信件内容进行加密，然后将这封加密的信件发送给小红。由于信件是用小红的公钥加密的，即便有人在途中截获了信件，没有小红的私钥，他们也无法解开信件内容。

●第三步：当小红收到加密的信件时，她用自己的私钥对信件进行解密，阅读信件内容。

私钥是唯一能够解开加密信息的钥匙，其他任何人即便拥有公钥也无法解密。通过这种方式，小明和小红确保了保密信件内容的安全性。


### 公私钥体系
公私钥体系是非对称加密的基础。在这个体系中，每个用户都有一对密钥：公钥和私钥，公钥是公开的，而私钥只能由用户自己保管。公私钥体系基于密码学原理，任何人都无法从公钥推导出对应的私钥。除了非对称加密之外，公私钥体系还有一个核心功能：数字签名。在后面的章节中，我们将会对数字签名技术做详细介绍。


## 数字签名和交易验证

上一章节，我们介绍了非对称加密：使用公钥进行加密，使用私钥进行解密，这样可以确保信息传输的安全性。小明和小红正是使用了非对称加密技术，才使得保密信件的内容在传递过程中不被泄露。

但是仅仅使用非对称加密来保护信件内容是不够的，因为小红的公钥是公开的，任何人都可以使用它来加密信息，假冒小明发送给小红。为了确保小红收到的信件确实来自小明，这里还需要另一种机制来验证消息的真实来源，这就是数字签名技术。

### 数字签名

数字签名技术使用私钥进行加密，使用公钥进行解密和验证，它能够验证消息是否由指定的发送者发出，并且在传输过程中没有被篡改，以确认信息的完整性和认证发送者的身份。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071855565.png)


我们还是以小明给小红发送保密信件来举例，他们不仅使用了非对称加密技术，还使用了数字签名技术。

●第一步：计算签名。小明先使用自己的私钥对消息密文进行加密，得到消息密文的签名，再将签名附加到消息密文中一起传输，发送给小红。

●第二步：恢复签名。小红收到消息密文和签名之后，使用公开获得的小明的公钥对签名进行解密，得到消息密文。

●第三步：验证签名。小红将收到的密文和解密签名恢复出来的密文进行对比，如果两者一致，则签名验证成功，说明收到的信件确实是小明发出的，同时还能证明信件在传输过程中没有被修改。


>  补充说明 
>  因为公私钥加密算法执行比较慢，如果消息比较大，签名过程会消耗很长时间。所以在实际应用中，一般先计算消息的哈希值，再计算哈希值的签名，这样可以减少签名耗时。还记得前面章节学习的哈希函数吗？无论消息内容有多少，计算的哈希值都是固定长度的。


### 交易验证

在以太坊中，数字签名技术用于交易验证，确保交易的真实性、完整性。交易验证主要有如下几步：

  
●用户签名交易。用户将交易数据准备好后，先计算出交易数据的哈希值，再使用椭圆曲线签名算法（ ECDSA ）对哈希值进行签名，将签名值（ v,r,s ）附加到交易数据中进行广播。

●矿工验证交易。矿工接收到一笔交易之后，同样，先计算出交易数据（不含签名）的哈希值，再使用椭圆曲线签名算法（ ECDSA ），从签名和哈希值中恢复出用户公钥。最后将恢复出的公钥与用户钱包地址做对比，如果两者一致，则交易验证成功。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071900417.png)



## 工作量证明 Pow

介绍区块链的工作量证明机制（ Proof of Work，以下简称 PoW ）之前，我们先了解一下 POW 机制的历史，便于更好的理解它的原理。

POW 的概念最初并非为加密货币而生，它在1993年由 Cynthia Dwork 和 Moni Naor 提出，用于抵御电子邮件服务中的垃圾邮件攻击。其基本思想是：要求用户在发送电子邮件之前，先计算一个和邮件内容相关的数学难题，并将计算结果附加在邮件上才能被邮件服务器接收。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071904102.png)

具体流程如下：

1.用户编写一封邮件。

2.用户发送邮件前必须先解决一个工作量证明问题，通常是找到一个符合特定条件的数字（ nonce ），比如将邮件内容和这个数字的组合后，使用哈希函数计算出的哈希值前面有4个零。用户在电脑上进行计算，找到这个数字之后，将其附加到邮件上，然后发送。

3.邮件服务器接收到邮件和附加的数字，快速验证工作量证明是否正确（即检查哈希值是否符合要求）。

4.如果工作量证明是正确的，邮件就会被发送至目标邮箱；如果不正确，则拒绝发送。

工作量证明的计算过程需要消耗一定的计算时间和资源，对于正常用户来说，这个额外的工作量是可接受的，因为它不会影响正常的邮件发送。然而，对于垃圾邮件发送者来说，他们通常要发送成千上万封的垃圾邮件，这个计算过程要消耗大量的时间和资源。通过这样的机制，使得垃圾邮件的发送成本大幅增加，从而有效地减少垃圾邮件的数量。

### 为什么要使用 Pow 机制

2008年，一个化名为中本聪（ Satoshi Nakamoto ）的人将 PoW 机制应用于比特币的创建过程中。

比特币是一个去中心化的分布式网络，当用户发起一笔新的交易后，网络中不存在一个中央权威来验证和确认交易。为了抵御恶意攻击，需要一种机制来确保所有网络参与者（节点）对交易记录的有效性和区块链的状态达成一致。POW 机制解决了这个共识问题，可以为比特币网络提供去中心化的安全保障，使得网络的运行不依赖于任何单一实体，以确保网络的安全性。


>交易验证方式：中心化网络 VS 去中心化网络 在传统的中心化金融网络中，每一笔交易都需要通过一个或多个中央权威的审核和确认，如银行、清算所、监管机构等，这些中央权威拥有对交易数据的访问权，并负责保证交易的安全和合规性。 相比之下，比特币等去中心化的区块链网络则通过分布式账本和共识机制来实现交易的验证和确认，无需中心化的权威机构。


### PoW 机制工作原理

那在区块链中，PoW 机制是如何工作的呢？

如下图，在比特币网络中，PoW 要求矿工通过解决一个数学难题来创建新的区块。这个数学难题实际上是在1~2^256之间找到一个数值（ nonce ），使得区块头信息的哈希值小于或等于网络当前的难度目标（ target ）。这个过程被称为“挖矿”。随着网络中的算力不断变化，为了确保创建区块创建的间隔时间相当，挖矿的难度目标（ target ）也会不断调整。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071908782.png)



### PoW 机制案例讲解

举一个简单的例子来解释 PoW 机制的工作过程，我们的目标是找到一个nonce值，使得区块头信息的哈希值小于或等于难度目标（ target ），即哈希值以三个零开头。

难度目标：000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff

矿工在打包交易后，产生的新区块头信息如下：

版本：1 上一个区块的哈希值：00065981574f0735bd36230451d837d12ad19f671a6d76ab0eefc6d55a7e8bec Merkle 根：b3a24bbaff8d6de77c2a021e0f3f4a9e8a2f0dbd0ea1eea9ece5f2f424a2bd5b 时间戳：1582215247 难度指数：1d00ffff Nonce：0（开始尝试的 nonce 值）

矿工的任务是不断改变 Nonce 值（从0开始累加），重新计算区块头的哈希值，直到找到一个小于或等于难度目标的哈希值。矿工开始尝试不同的 Nonce 值：

●第1次尝试 (不满足条件)

Nonce：1

哈希值：fae998a99254508c137f0c535f8f25fbb69e7cc6af78a7f365546a87314dab77 

●第2次尝试 (不满足条件)

Nonce：2

哈希值：001a744a87365442d2593d896bda9942a128fa4c7acb3a47b0dd98c77fb67216

●第3次尝试 (不满足条件)

Nonce：3

哈希值：0b3468b4bbc3f1614d592daeff613564ab1678694562a5e0033afa7e71bfffcc

… …

●第23568次尝试 (满足条件，哈希值以三个零开头)

Nonce：23568

哈希值：00019c284da6661956525526eba9e09d474257b33a221130de29db6b926caca6

当尝试了23568次之后，即 Nonce 值为23568时，矿工找到了一个满足条件的哈希值（以三个零开头），这就意味着挖矿成功，新的区块可以被添加到区块链上。此时其他节点的矿工将验证这个区块是否符合难度要求，一旦验证正确，矿工将停止本次挖矿，立即开始下一个区块的挖矿。

这是一个简化版的挖矿。在现实中，比特币网络的难度目标更加复杂，矿工通常需要尝试数十亿次 Nonce 值，才能找到符合条件的哈希值。新区块被添加到区块链上之后，创建区块的矿工将获得一定的代币奖励，比如2024年比特币减半后，挖矿奖励是3.125个比特币。


### 最长链原则

在比特币网络中，有大量的矿工在同时挖矿，很容易同时出现多个合法区块，导致区块链分叉。分叉后新创建的区块将添加到哪条链中呢？

此时矿工遵循最长链原则，默认选择最长的一条链，即总算力最大的链，作为有效链继续挖矿，因为最长链代表了网络中最大的工作量。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411071914454.png)

总结来说，PoW 机制有效的解决了去中心化分布式网络中的共识问题，允许系统中的各个节点在没有中央权威或相互信任的情况下达成一致，至今已成为许多加密货币广泛使用的共识算法。PoW 机制也使得对系统的攻击变得非常困难，因为攻击者需要控制超过50%的网络算力才能影响区块链的状态（51%攻击）。

然而，PoW 机制也有劣势，例如高能耗和潜在的中心化风险。2014年 [GHash.IO](http://ghash.io/) 矿池的算力一度占到了全球比特币网络算力的一半以上，它理论上有能力进行“51%攻击”，引起社区的广泛关注，后来 GHash.IO 自愿降低了自己的算力份额，承诺不会超过全网的39.99%。

## 权益证明 PoS


### 为什么需要权益证明

在区块链技术发展初期，最广为人知的共识机制是 PoW 工作量证明（详见上一章节）。然而，随着时间的推移，人们逐渐意识到 PoW 机制存在一些问题，例如电力能耗巨大和算力集中化，网络去中心化的特性受到威胁。为了解决这些问题，权益证明机制（ Proof of Stake, 以下简称 PoS ）应运而生。


### 工作原理

与 Pow 机制不同，PoS 机制不依赖于算力竞争。参与者通过质押一定数量的加密货币，来获得成为区块创建者（也称验证者）的资格。

每次创建新区块时，区块链协议会从所有质押的验证者中随机抽选一名，当被抽中的验证者创建一个区块后，其他节点将会对该区块进行验证。如果验证通过，该区块就会被添加到区块链上，并且创建者将会获得一定的加密货币作为奖励。每个验证者被抽中的概率与质押的金额大小有关，通常质押越多的验证者被抽中的机会越大。例如，在以太坊2.0版本中，验证者至少需要质押32个以太币（ETH）才有资格创建区块。通过这种方式，PoS 机制实现一个更搞笑、更节能的区块链网络。

![image.png](https://cdn.jsdelivr.net/gh/Silence-dream/bed@master/img/202411081529139.png)

我们来举一个例子,介绍权益证明机制的工作过程:
假如小明有一定数量的以太币(ETH),他希望成为以太坊网络的验证者。

●第一步：质押 ETH。小明将32个甚至更多的 ETH 转入以太坊的存款合约中，这些ETH将作为质押锁定在合约中，质押后小明就拥有了被提议的资格。

第二步：抽取验证者。假如小明比较幸运，质押后不久就被区块链协议选中为验证者，来创建下一个区块。

●第三步：创建区块。当小明被选中后，他将负责在指定的时间内创建一个新区块。于是小明开始收集网络上未确认的交易，并验证这些交易的有效性，将它们打包成一个新的区块，广播到网络中。

●第四步：验证区块。其他节点接收到这个新区块后，就会对区块进行验证。一旦验证正确，新区块就会加入区块链中，小明也将获得一定的区块奖励和交易费用作为回报。

## 其他共识算法

在区块链技术中，除了著名的工作量证明（ PoW ）和权益证明（ PoS ）两种共识机制外，还有很多其他的共识算法被采用。


以下是其他常见的共识算法：

●历史证明（ PoH ）：PoH 旨在通过创建一个可信的时间记录来验证事件的顺序和时间，使得网络参与者可以在没有互相通信的情况下验证事件发生的先后顺序。

●实用拜占庭容错算法（ PBFT ）：用于容忍系统内一定比例的节点存在恶意行为的情况，确保全网能够达成一致。PBFT 非常适用于私有或联盟链。

●委托权益证明（ DPoS ）：这是一种增强版的 PoS，用户将投票权委托给少数代表，这些代表负责验证和添加新的区块到区块链。DPoS 旨在提高网络的可扩展性和交易速度。

●权威证明（ PoA ）：在 PoA 中，交易和区块的验证是由预先选定的、受信任的节点（验证者）完成的。这些节点通常会因为身份的公开而承担责任，适用于那些需要速度和效率的网络。

●纯权益证明（ Pure PoS ）：PPoS 消除了 PoS 中的潜在中心化问题，通过随机选择验证者来确保网络的去中心化和安全性。

●空间证明（ PoSpace ）或容量证明（ PoC ）：这类算法基于网络参与者提供的存储空间大小来选择区块生产者，它的优点是对电力能源的消耗较低。

●认证证明（ PoAuth ）：类似于 PoA，但 PoAuth 要求验证者的身份是公开的，他们通常是由社区信任的人或公司。



